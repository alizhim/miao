<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>五子棋</title>
  <style>
    .title {
      text-align: center;
    }
    .chess {
      display: block;
      margin: 50px auto;
      box-shadow: 5px 5px 5px #b9b9b9, -2px -2px 2px #efefef;
      cursor: pointer;
    }
    div {
      text-align: center;
    }
    .restart {
      padding: 10px 20px;
      background-color: aquamarine;
      color: white;
      cursor: pointer;
      border-radius: 5px;
    }
  </style>
</head>
<body>
  <h3 class="title">--五子棋--</h3>
  <canvas class="chess" width="450px" height="450px"></canvas>
  <div>
    <a class="restart">重新开始</a>
  </div>
  <script>
    var chess = document.getElementsByClassName('chess')[0]
    var title = document.getElementsByClassName('title')[0]
    var context = chess.getContext('2d')
    context.strokeStyle = '#b9b9b9'
    window.onload = function() {
      drawChessBoard()
    }
    function drawChessBoard() {
      for (var i = 0; i < 15; i++) {
        //设置横线的起始点
        context.moveTo(15, 15 + i * 30)
        //设置横线的结束点
        context.lineTo(435, 15 + i * 30)
        //链接两点
        context.stroke()
        //设置竖线的起始点
        context.moveTo(15 + i * 30, 15)
        //设置竖线的结束点
        context.lineTo(15 + i * 30, 435)
        //链接两点
        context.stroke()
      }
    }
    var wins = []
    for (var i = 0; i < 15; i ++) {
      wins[i] = []
      for (var j = 0; j < 15; j++) {
        wins[i][j] = []
      }
    }
    //赢法的编号
    var count = 0
    //统计横线赢法
    for (var i = 0; i < 15; i++) {
      for (var j = 0; j < 11; j++) {
        for (var k = 0; k < 5; k++) {
          wins[j + k][i][count] = true
        }
        count++
      }
    } 
    //统计竖线赢法
    for (var i = 0; i < 15; i++) {
      for (var j = 0; j < 11; j++) {
        for (var k = 0; k < 5; k++) {
          wins[i][j + k][count] = true
        }
        count++
      }
    } 
     //统计正斜线赢法
     for (var i = 0; i < 11; i++) {
      for (var j = 0; j < 11; j++) {
        for (var k = 0; k < 5; k++) {
          wins[i + k][j + k][count] = true
        }
        count++
      }
    }
    //统计反斜线赢法
    for (var i = 0; i < 11; i++) {
      for (var j = 14; j > 3; j--) {
        for (var k = 0; k < 5; k++) {
          wins[i + k][j - k][count] = true
        }
        count++
      }
    }
    //定义二维数组标记标记棋盘上的每个坐标是否已经下了棋子
    var chessboard = []
    for (var i = 0; i < 15; i++) {
      chessboard[i] = []
      for (var j = 0; j < 15; j++) {
        chessboard[i][j] = 0
      }
    } 
    //下棋
    var me = true   //标记人是否可以下棋 
    var over = false  //标记游戏是否结束
    var myWin = []  //记录用户在赢法上的分值
    var computerWin = [] //记录计算机在赢法上的分值
    for (var i = 0; i < count; i++) {
      myWin[i] = 0
      computerWin[i] = 0
    }
    chess.onclick = function(e) {
      //如果游戏结束了不可以下棋
      if (over) {
        return
      }
      //判断人是否可以下棋
      if (!me) {
        return
      }
      //获取x轴坐标
      var x = e.offsetX
      //获取y轴坐标
      var y = e.offsetY
      var i = Math.floor(x / 30)
      var j = Math.floor(y / 30)
      if (chessboard[i][j] == 0) {
        //下一个子
        oneStep(i, j, me)
        //标记已经落子
        chessboard[i][j] = 1
        for (var k = 0; k < count; k++) {
          if (wins[i][j][k]) {
            myWin[k]++
            if (myWin[k] == 5) {
              title.innerHTML = '--恭喜你获胜了！--'
              over = true
            }
          }
        }
      }
    }
    //落子的方法
    function oneStep(i, j, me) {
      context.beginPath()
      context.arc(15 + i * 30, 15 + j * 30, 13, 0, 2 * Math.PI) //画圆
      context.closePath()
      var color
      if (me) {
        color = 'black'
      } else {
        color = 'red'
      }
      context.fillStyle = color
      context.fill()
    }
    if (!over) {
      me = !me
      //计算机落子
    }
    function computerAi() {
      //空白子在用户所占用赢法上的分值
      var myScore = []
      //空白子在计算机所占用赢法上的分值
      var computerScore = []
      for (var i = 0; i < 15; i++) {
        myScore[i] = []
        computerScore[i] = []
        for (var j = 0; j < 15; j ++) {
          myScore[i][j] = 0
          computerScore[i][j] = 0
        }
      }
      //空白子的最大分值
      var max = 0
      //最大分值空白子所在的坐标
      var x = 0
      var y = 0
      for (var i = 0; i < 15; i++) {
        for (var j = 0; j <15; j++) {
          //判断是否是空白子
          if (chessboard[i][j] == 0) {
            for (var k = 0; k < count++; k++) {
              if (wins[i][j][k]) {
                if (myWin[k] == 1) {
                  myScore[i][j] += 200
                } else if (myWin[k] == 2) {
                  myScore[i][j] += 400
                } else if (myWin[k] == 3) {
                  myScore[i][j] += 2000
                } else if (myWin[k] == 4) {
                  myScore[i][j] += 10000
                }
        }
      }
    }
  </script>
</body>
</html>